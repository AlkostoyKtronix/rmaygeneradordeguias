<!DOCTYPE html>
<html lang="es">
<head>
<link rel="icon" href="https://dplnews.com/wp-content/uploads/2022/02/dplnews_claro_mc100222.jpeg" type="image/x-icon">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Formulario de Gestión Backoffice HFC</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flatpickr/4.6.6/flatpickr.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }
  .titulo {
    width: 103%;
    background-color: #000000;
    text-align: center;
    color: white;
    margin-bottom: 0px;
  }

  .botones-container {
    background-color: #000000;
    margin-top: 0px;
    width: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    flex-wrap: wrap;
    margin-bottom: 30px;
    border: 40px solid #000000;
  }

  .form-container {
    display: flex;
    align-items: flex-start;
    justify-content: flex-start;
    gap: 20px;
    padding: 20px;
  }

  .forms-wrapper {
    display: flex;
    flex-direction: column;
    gap: 20px;
  }

  .botones-container button {
    background-color: #000000;
    color: white;
    padding: 12px 20px;
    border: 2px solid white;
    border-radius: 5px;
    margin: 2px;
    cursor: pointer;
    font-size: 16px;
  }

  .container {
    display: flex;
    justify-content: center;
    align-items: flex-start;
    flex-wrap: wrap;
    overflow: hidden;
    padding: 20px;
  }

  #mini-form, #main-form, #details-form, .text-container {
    max-width: 400px;
    padding: 50px;
    border: 1px solid #ccc;
    border-radius: 5px;
    margin: 20px;
    margin-bottom: 40px;
  }

  #details-form {
    display: flex;
    flex-direction: column;
    width: 100%;
    max-width: 1300px;
    margin: 30px auto;
    margin-top: 40px;
    margin-right: 30px;
    padding-left: 40px;
  }

  #details-form .form-section {
    width: 100%;
  }

  #details-form .form-section textarea {
    width: 100%;
    box-sizing: border-box;
  }

  .form-section {
    border: 1px solid #ccc;
    padding: 20px;
    border-radius: 5px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    background-color: #fff;
    margin-bottom: 20px;
  }

  .form-section label {
    display: block;
    margin-bottom: 8px;
    color: #333;
  }

  .form-section input, 
  .form-section select, 
  .form-section textarea {
    width: 100%;
    box-sizing: border-box;
    padding: 10px;
    margin-bottom: 10px;
    border: 1px solid #ccc;
    border-radius: 5px;
    font-family: Arial, sans-serif;
    font-size: 14px;
  }

  .form-section textarea {
    height: 100px;
    resize: vertical;
  }

  button {
    background-color: #000000;
    color: white;
    padding: 10px 130px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    margin-top: 10px;
    font-size: 20px;
  }

  button:hover {
    background-color: #ddd;
  }

  .text-container {
    max-width: 400px;
    padding: 20px;
    border: 1px solid #ccc;
    border-radius: 5px;
    margin: 0px;
    gap: 15px; 
    margin-left: 30px;
    padding-top: 20px;
    border-top-width: 0px;
    border-left-width: 0px;
    border-right-width: 0px;
    border-bottom-width: 0px;
  }

  .textarea-item {
    max-width: 400px;
    padding: 20px;
    border: 1px solid #ccc;
    border-radius: 5px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    background-color: #fff;
  }

  .textarea-item label {
    margin-bottom: 5px;
    display: block;
    color: #333;
  }

  .textarea-item button {
    background-color: #000000;
    color: white;
    padding: 10px 150px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    margin-top: 10px;
    font-size: 16px;
  }

  .textarea-item button:hover {
    background-color: #ccc;
  }

  #text1, #text2, #text3 {
    width: 350px;
    height: 200px;
  }

  #Observaciones, #PDSR, #redAccesoDet, #ruta, #ping, #capa2, #capa3 {
    width: 400px;
    height: 100px;
  }

  .horizontal-textareas {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
  }

  .horizontal-textareas div {
    flex: 1 1 calc(33.33% - 15px);
    min-width: 250px;
  }

  .horizontal-textareas textarea {
    width: 100%;
    height: 80px;
  }

  .popup-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    display: none;
    justify-content: center;
    align-items: center;
  }

  .popup-content {
    background-color: white;
    padding: 20px;
    border-radius: 5px;
    width: 80%;
    max-width: 600px;
  }

  .popup-content h2 {
    margin-top: 0;
  }

  .tabs {
    display: flex;
    justify-content: space-between;
    margin-bottom: 20px;
  }

  .tab {
    flex: 1;
    text-align: center;
    padding: 10px;
    cursor: pointer;
    background-color: #f1f1f1;
    border: 1px solid #ccc;
  }

  .tab.active {
    background-color: #ddd;
    font-weight: bold;
  }

  .tab-content {
    display: none;
  }

  .tab-content.active {
    display: block;
  }

  .close-btn {
    background-color: #000;
    color: white;
    border: none;
    padding: 10px;
    cursor: pointer;
    margin-top: 20px;
  }

  .close-btn:hover {
    background-color: #333;
  }

  .form-container {
    display: flex;
    align-items: flex-start;
    justify-content: flex-start;
    gap: 20px;
  }

  /* Estilos para las plantillas de formato */
  .formato-template {
    position: fixed;
    top: -10000px;
    left: -10000px;
    visibility: hidden;
    width: 210mm;
    height: 297mm;
  }
  
  .formato-p-container {
    width: 210mm;
    height: 297mm;
    position: relative;
    padding: 10px;
    box-sizing: border-box;
    background-color: white;
  }

  .formato-averi-container {
    width: 210mm;
    height: 297mm;
    position: relative;
    padding: 10px;
    box-sizing: border-box;
    background-color: white;
  }

  /* ESTILOS ACTUALIZADOS PARA FORMATO P */
  .p-grid {
    position: absolute;
    top: 20px;
    left: 10px;
    width: 180mm;
    height: 90mm;
    border: 1px solid #000;
  }

  .p-cell {
    position: absolute;
    box-sizing: border-box;
    padding: 2px 2px 2px 10px; /* Texto movido a la derecha */
  }

  .p-yellow {
    background-color: #FFD400;
    display: flex;
    justify-content: center;
    align-items: center;
    border: none !important;
    outline: none !important;
  }

  .p-big-text {
    font-size: 80px;
    font-weight: bold;
  }

  .p-center-text {
    text-align: center;
  }

  .p-observaciones-container {
    position: absolute;
    width: 60mm;
    height: 15mm;
    top: 45mm;
    left: 60mm;
    padding: 2px 2px 2px 10px;
    box-sizing: border-box;
  }

  .p-linea-vertical {
    position: absolute;
    width: 0;
    height: 15mm;
    border-left: 1px solid #000;
    left: 60mm;
    top: 60mm;
  }

  /* Estilos específicos para el formato AVERI */
  .averi-grid {
    position: absolute;
    top: 20px;
    left: 10px;
    width: 180mm;
    height: 247mm;
    border: 1px solid #000;
  }

  .averi-cell {
    position: absolute;
    box-sizing: border-box;
    padding-left: 5px;
    display: flex;
    align-items: center;
  }

  .averi-bold {
    font-size: 18px;
    font-weight: bold;
  }

  .averi-obs {
    align-items: flex-start;
    padding: 5px;
  }
</style>
</head>
<body>

<div class="titulo">
    <h1>PLANTILLA CREACION DE RMA</h1>
</div>

<div class="botones-container">
    <button onclick="window.location.href='PLANTILLAS_RMA_ALKOSTO.html'">Plantilla RMA</button>
    <button onclick="window.location.href='PLANTILLAS_ODS.html'">Generador de Guias</button>
    <button onclick="window.location.href='PLANTILLAS_DEVOLUCIONES.html'">Generador PDF Devoluciones</button>
</div>

<div class="form-container">
    <div class="form-section">
        <div class="container">
            <form id="mini-form">
                <label for="caso">Caso/ODS:</label>
                <input type="text" id="caso" name="caso" required><br>

                <label for="accesorios">Accesorios:</label>
                <input type="text" id="accesorios" name="accesorios" required><br>

                <label for="origen">Origen:</label>
                <input type="text" id="origen" name="origen" required><br>

                <label for="unidad">Unidad de Negocio:</label>
                <input type="text" id="unidad" name="unidad" required><br>

                <label for="fecha">Fecha de Solicitud:</label>
                <input type="text" id="fecha" name="fecha" class="datepicker" required><br>

                <label for="tecnico">Tecnico:</label>
                <input type="text" id="tecnico" name="tecnico" required><br>

                <label for="abreviatura">Motivo Recoleccion:</label>
                <select id="abreviatura" name="abreviatura" required>
                    <option value="falla">falla</option>
                    <option value="REC_NO_SA">REC_NO_SA</option>
                    <option value="REC_DÑ_EX">REC_DÑ_EX</option>
                    <option value="REC_DÑ_IN">REC_DÑ_IN</option>
                    <option value="REC_INCOM">REC_INCOM</option>
                    <option value="PANRT">PANRT</option>
                </select><br>
            </form>

            <form id="main-form">
                <h2>Plantilla RMA</h2>
                <label for="ean">EAN:</label>
                <input type="text" id="ean" name="ean">

                <label for="estadoproducto">Estado de producto:</label>
                <input type="text" id="estadoproducto" name="estadoproducto">

                <label for="serial">Serial:</label>
                <input type="text" id="serial" name="serial">

                <label for="formato">Formato:</label>
                <input type="text" id="formato" name="formato">

                <label for="motivo">Motivo:</label>
                <input type="text" id="motivo" name="motivo">

                <label for="proceso">Proceso (RMA - ODS):</label>
                <select id="proceso" name="proceso" required>
                    <option value="RMA">RMA</option>
                    <option value="ODS">ODS</option>
                </select><br>

                <label for="trasportador">Trasportador (Pro - coordi):</label>
                <select id="trasportador" name="trasportador" required>
                    <option value="Propio">Propio</option>
                    <option value="Coordinadora">Coordinadora</option>
                    <option value="Envia">Envia</option>
                </select><br>

                <label for="destino">Destino:</label>
                <input type="text" id="destino" name="destino">

                <label for="direccion">Dirección:</label>
                <input type="text" id="direccion" name="direccion">

                <label for="telefonos">Telefonos:</label>
                <input type="text" id="telefonos" name="telefonos">

                <label for="fecharecoleccion">Fecha recolección:</label>
                <input type="text" id="fecharecoleccion" name="fecharecoleccion" class="datepicker-next-day"><br>

                <label for="frecuencia">Dia - Frecuencia:</label>
                <input type="text" id="frecuencia" name="frecuencia">

                <label for="observaciones">Observaciones del caso:</label>
                <input type="text" id="observaciones" name="observaciones">
            
                <button type="button" onclick="generarPlantillas()">Generar Plantillas</button>
                <button type="button" onclick="generarFormatoP()">Generar Formato P</button>
                <button type="button" onclick="generarFormatoAveri()">Generar Formato Averi</button>
            </form>
            
            <div class="text-container">       
                <div class="textarea-item">
                    <label for="text1">Plantilla RMA:</label>
                    <textarea id="text1" readonly></textarea>
                    <button onclick="copyToClipboard('text1')">Copiar</button>
                </div>
                
                <div class="textarea-item">
                    <label for="text2">Plantilla Observaciones RMA:</label>
                    <textarea id="text2" readonly></textarea>
                    <button onclick="copyToClipboard('text2')">Copiar</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Plantilla para el Formato P - VERSIÓN FINAL -->
<div id="formato-p-template" class="formato-template">
    <div class="formato-p-container">
        <div class="p-grid">
            <!-- Celda P amarilla SIN BORDES INTERNOS -->
            <div class="p-cell p-yellow" style="width:60mm; height:45mm; top:0; left:120mm;">
                <span class="p-big-text">P</span>
            </div>
            
            <!-- Líneas horizontales principales - MODIFICADAS PARA NO CRUZAR EL RECUADRO AMARILLO -->
            <div style="position:absolute; width:120mm; height:0; border-top:1px solid #000; top:15mm; left:0;"></div>
            <div style="position:absolute; width:120mm; height:0; border-top:1px solid #000; top:30mm; left:0;"></div>
            <div style="position:absolute; width:120mm; height:0; border-top:1px solid #000; top:45mm; left:0;"></div>
            <div style="position:absolute; width:180mm; height:0; border-top:1px solid #000; top:60mm;"></div>
            <div style="position:absolute; width:180mm; height:0; border-top:1px solid #000; top:75mm;"></div>
            
            <!-- Líneas verticales principales -->
            <div style="position:absolute; width:0; height:60mm; border-left:1px solid #000; left:60mm; top:0;"></div>
            <div style="position:absolute; width:0; height:45mm; border-left:1px solid #000; left:120mm; top:0;"></div>
            
            <!-- Línea vertical entre EAN y Accesorios -->
            <div class="p-linea-vertical"></div>
            
            <!-- Contenido principal -->
            <div class="p-cell p-center-text" style="width:60mm; height:15mm; top:0; left:0;">PV</div>
            <div class="p-cell p-center-text" id="p-pv-value" style="width:60mm; height:15mm; top:15mm; left:0;"></div>
            
            <div class="p-cell p-center-text" style="width:60mm; height:15mm; top:0; left:60mm;">Fecha</div>
            <div class="p-cell p-center-text" id="p-fecha-value" style="width:60mm; height:15mm; top:15mm; left:60mm;"></div>
            
            <div class="p-cell" style="width:60mm; height:15mm; top:30mm; left:0;">
                <span>Serial: </span><span id="p-serial-value"></span>
            </div>
            <div class="p-cell" style="width:60mm; height:15mm; top:30mm; left:60mm;">
                <span>OT: </span><span id="p-ot-value"></span>
            </div>
            
            <!-- OBSERVACIONES en posición correcta -->
            <div class="p-observaciones-container">
                <span style="font-weight:bold;">OBSERVACIONES: </span>
                <span id="p-observaciones-value" style="white-space: nowrap;"></span>
            </div>
            
            <div class="p-cell" style="width:60mm; height:15mm; top:45mm; left:0;">
                <span>Tecnico: </span><span id="p-tecnico-value"></span>
            </div>
            
            <div class="p-cell" style="width:60mm; height:15mm; top:60mm; left:0;">
                <span>EAN: </span><span id="p-ean-value"></span>
            </div>
            <div class="p-cell" style="width:60mm; height:15mm; top:60mm; left:60mm;">
                <span>Accesorios: </span><span id="p-accesorios-value"></span>
            </div>
            
            <!-- Campo FT con espacios corregidos -->
            <div class="p-cell" style="width:180mm; height:15mm; top:75mm; left:0; border-top:1px solid #000;">
                <span>FT: </span><span id="p-ft-value"></span>
            </div>
        </div>
    </div>
</div>

<!-- Plantilla para el Formato AVERI -->
<div id="formato-averi-template" class="formato-template">
    <div class="formato-averi-container">
        <div class="averi-grid">
            <!-- Celda AVE -->
            <div class="averi-cell averi-bold" style="width:120mm; height:15mm; top:0; left:0; border-right:1px solid #000; border-bottom:1px solid #000;">
                AVE
            </div>
            <div class="averi-cell" style="width:60mm; height:5mm; top:0; left:120mm; border-bottom:1px solid #000;">
                Unidad de Negocio: <span id="averi-destino-value"></span>
            </div>
            <div class="averi-cell" style="width:60mm; height:5mm; top:5mm; left:120mm; border-bottom:1px solid #000;">
                Origen: <span id="averi-origen-value"></span>
            </div>
            <div class="averi-cell" style="width:60mm; height:5mm; top:10mm; left:120mm;">
                Cambios:    PTOV:    N/A: X
            </div>
            
            <!-- Línea horizontal divisoria -->
            <div style="position:absolute; width:180mm; height:0; border-top:1px solid #000; top:15mm;"></div>
            
            <!-- Filas 4-9 -->
            <div class="averi-cell" style="width:60mm; height:5mm; top:15mm; left:0; border-right:1px solid #000;">
                EAN: <span id="averi-ean-value"></span>
            </div>
            <div class="averi-cell" style="width:60mm; height:5mm; top:15mm; left:60mm; border-right:1px solid #000;">
                OT: <span id="averi-ot-value"></span>
            </div>
            <div class="averi-cell" style="width:60mm; height:5mm; top:15mm; left:120mm;">
                Serial: <span id="averi-serial-value"></span>
            </div>
            
            <!-- Línea horizontal divisoria -->
            <div style="position:absolute; width:180mm; height:0; border-top:1px solid #000; top:20mm;"></div>
            
            <div class="averi-cell" style="width:60mm; height:5mm; top:20mm; left:0; border-right:1px solid #000;">
                ACCESORIOS: 
            </div>
            <div class="averi-cell" style="width:60mm; height:5mm; top:20mm; left:60mm; border-right:1px solid #000;">
                <span id="averi-accesorios-value"></span>
            </div>
            <div class="averi-cell" style="width:60mm; height:5mm; top:20mm; left:120mm;">
                FT: N/A
            </div>
            
            <div style="position:absolute; width:180mm; height:0; border-top:1px solid #000; top:25mm;"></div>
            
            <div class="averi-cell" style="width:60mm; height:5mm; top:25mm; left:0; border-right:1px solid #000;">
                Solicitado el día:
            </div>
            <div class="averi-cell" style="width:60mm; height:5mm; top:25mm; left:60mm; border-right:1px solid #000;">
                <span id="averi-fecha-value"></span>
            </div>
            <div class="averi-cell" style="width:60mm; height:5mm; top:25mm; left:120mm;">
                Solicitante: <span id="averi-tecnico-value"></span>
            </div>
            
            <div style="position:absolute; width:180mm; height:0; border-top:1px solid #000; top:30mm;"></div>
            
            <div class="averi-cell" style="width:180mm; height:5mm; top:30mm; left:0;">
                Autoriza Coordinador:
            </div>
            
            <div style="position:absolute; width:180mm; height:0; border-top:1px solid #000; top:35mm;"></div>
            
            <div class="averi-cell" style="width:60mm; height:5mm; top:35mm; left:0; border-right:1px solid #000;">
                Técnico que valida:
            </div>
            <div class="averi-cell" style="width:120mm; height:5mm; top:35mm; left:60mm;">
                Sebastian Ovalle
            </div>
            
            <div style="position:absolute; width:180mm; height:0; border-top:1px solid #000; top:40mm;"></div>
            
            <div class="averi-cell averi-obs" style="width:180mm; height:15mm; top:40mm; left:0;">
                Observaciones: <span id="averi-observaciones-value"></span>
            </div>
            
            <!-- Líneas verticales principales -->
            <div style="position:absolute; width:0; height:25mm; border-left:1px solid #000; left:60mm; top:15mm;"></div>
            <div style="position:absolute; width:0; height:25mm; border-left:1px solid #000; left:120mm; top:15mm;"></div>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/flatpickr/4.6.6/flatpickr.min.js"></script>
<script>
// Configuración de los calendarios
document.addEventListener('DOMContentLoaded', function() {
    // Fecha actual
    flatpickr("#fecha", {
        dateFormat: "d/m/Y",
        defaultDate: "today",
        allowInput: true
    });
    
    // Fecha siguiente al día actual
    const tomorrow = new Date();
    tomorrow.setDate(tomorrow.getDate() + 1);
    
    flatpickr("#fecharecoleccion", {
        dateFormat: "d/m/Y",
        defaultDate: tomorrow,
        allowInput: true
    });
});

function generarPlantillas() {
    // Obtener valores del formulario
    const ean = document.getElementById('ean').value;
    const estadoproducto = document.getElementById('estadoproducto').value;
    const serial = document.getElementById('serial').value;
    const formato = document.getElementById('formato').value;
    const motivo = document.getElementById('motivo').value;
    const proceso = document.getElementById('proceso').value;
    const trasportador = document.getElementById('trasportador').value;
    const destino = document.getElementById('destino').value;
    const direccion = document.getElementById('direccion').value;
    const telefonos = document.getElementById('telefonos').value;
    const fecharecoleccion = document.getElementById('fecharecoleccion').value;
    const frecuencia = document.getElementById('frecuencia').value;
    const observaciones = document.getElementById('observaciones').value;
    const caso = document.getElementById('caso').value;
    const abreviatura = document.getElementById('abreviatura').value;

    // Generar contenido para text1
    document.getElementById('text1').value = `Ean: ${ean}
Estado de producto: ${estadoproducto}
Serial: ${serial}
Formato: ${formato}
Motivo: ${motivo}
Proceso (RMA - ODS): ${proceso}
Trasportador (Pro - Coordi): ${trasportador}
Destino: ${destino}
Dirección: ${direccion}
Teléfonos: ${telefonos}
Fecha recolección: ${fecharecoleccion}
Dia - Frecuencia: ${frecuencia}
Observaciones del caso: ${observaciones}`;

    // Generar contenido para text2
    document.getElementById('text2').value = `Caso: ${caso} // ${direccion} // ${telefonos} // Estado: ${abreviatura} // Formato: ${formato} // Destino: ${destino} // Serial: ${serial} // Motivo: ${motivo}`;
}

function copyToClipboard(textareaId) {
    const textarea = document.getElementById(textareaId);
    textarea.select();
    document.execCommand('copy');
    alert('Texto copiado al portapapeles');
}

// Función mejorada para generar y descargar imagen JPG
async function generarImagen(contenedorId, nombreArchivo) {
    try {
        const elemento = document.getElementById(contenedorId);
        
        // Hacer visible temporalmente el elemento
        elemento.style.position = 'absolute';
        elemento.style.visibility = 'visible';
        elemento.style.top = '0';
        elemento.style.left = '0';
        elemento.style.zIndex = '9999';
        
        // Esperar un momento para que el navegador renderice los cambios
        await new Promise(resolve => setTimeout(resolve, 100));
        
        // Configuración de html2canvas
        const opciones = {
            scale: 2,
            logging: false,
            useCORS: true,
            backgroundColor: '#FFFFFF',
            allowTaint: true,
            scrollX: 0,
            scrollY: 0,
            windowWidth: elemento.offsetWidth,
            windowHeight: elemento.offsetHeight
        };
        
        const canvas = await html2canvas(elemento, opciones);
        
        // Ocultar el elemento nuevamente
        elemento.style.position = 'fixed';
        elemento.style.visibility = 'hidden';
        elemento.style.top = '-10000px';
        elemento.style.left = '-10000px';
        elemento.style.zIndex = '';
        
        // Crear enlace de descarga
        const link = document.createElement('a');
        link.download = nombreArchivo + '.jpg';
        link.href = canvas.toDataURL('image/jpeg', 0.95);
        
        // Simular clic en el enlace para descargar
        document.body.appendChild(link);
        link.click();
        
        // Eliminar el enlace después de la descarga
        setTimeout(() => {
            document.body.removeChild(link);
        }, 100);
    } catch (error) {
        console.error("Error al generar imagen:", error);
        alert("Error al generar la imagen. Verifica la consola.");
    }
}

// FORMATO P (solo imagen JPG)
async function generarFormatoP() {
    // Obtener valores del formulario
    const getValue = id => document.getElementById(id).value;
    const valores = {
        origen: getValue('origen'),
        fecha: getValue('fecha'),
        serial: getValue('serial'),
        estadoproducto: getValue('estadoproducto'),
        caso: getValue('caso'),
        tecnico: getValue('tecnico'),
        ean: getValue('ean'),
        accesorios: getValue('accesorios'),
        observaciones: getValue('observaciones')
    };

    // Actualizar plantilla con valores reales
    document.getElementById('p-pv-value').textContent = valores.origen;
    document.getElementById('p-fecha-value').textContent = valores.fecha;
    document.getElementById('p-serial-value').textContent = valores.serial;
    document.getElementById('p-ot-value').textContent = valores.caso;
    document.getElementById('p-tecnico-value').textContent = valores.tecnico;
    document.getElementById('p-ean-value').textContent = valores.ean;
    document.getElementById('p-accesorios-value').textContent = valores.accesorios;
    document.getElementById('p-observaciones-value').textContent = valores.estadoproducto;
    
    // Corregir espacios en el texto FT
    const textoFT = valores.observaciones.replace(/([A-Z])([A-Z])/g, '$1 $2');
    document.getElementById('p-ft-value').textContent = textoFT;

    // Generar imagen
    await generarImagen('formato-p-template', `Formato_P_${valores.caso}`);
}

// FORMATO AVERI (solo imagen JPG)
async function generarFormatoAveri() {
    // Obtener valores del formulario
    const getValue = id => document.getElementById(id).value;
    const valores = {
        destino: getValue('destino'),
        origen: getValue('origen'),
        ean: getValue('ean'),
        caso: getValue('caso'),
        serial: getValue('serial'),
        accesorios: getValue('accesorios'),
        fecha: getValue('fecha'),
        observaciones: getValue('observaciones'),
        tecnico: getValue('tecnico')
    };

    // Actualizar plantilla con valores reales
    document.getElementById('averi-destino-value').textContent = valores.destino;
    document.getElementById('averi-origen-value').textContent = valores.origen;
    document.getElementById('averi-ean-value').textContent = valores.ean;
    document.getElementById('averi-ot-value').textContent = valores.caso;
    document.getElementById('averi-serial-value').textContent = valores.serial;
    document.getElementById('averi-accesorios-value').textContent = valores.accesorios;
    document.getElementById('averi-fecha-value').textContent = valores.fecha;
    document.getElementById('averi-observaciones-value').textContent = valores.observaciones;
    document.getElementById('averi-tecnico-value').textContent = valores.tecnico;

    // Generar imagen
    await generarImagen('formato-averi-template', `Formato_Averi_${valores.caso}`);
}
</script>
</body>
</html>